---
title: "Next.js+TSã§ãƒ•ãƒ­ãƒ³ãƒˆãƒ»ãƒãƒƒã‚¯ã‚’å®Œçµã•ã›ã‚‹å€‹äººé–‹ç™º â‘¡ãƒ›ãƒ¼ãƒ ç”»é¢ã€œãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [shadcn, nextjs, oauth2, react]
published: true
published_at: 2025-02-12 09:00
publication_name: "ka_projects"
---

## ã¯ã˜ã‚ã«

[å‰å›](https://zenn.dev/luck24247/articles/8f1f5f4d86164a)ã®ç¶šãã¨ã—ã¦ã€ä»Šå›ã¯ãƒ›ãƒ¼ãƒ ç”»é¢ã¨ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†å‘¨ã‚Šã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã™ã€‚  
Next.js ã® App Router ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ›ãƒ¼ãƒ ç”»é¢ã«å‹•ç”»ã‚’è¡¨ç¤ºã—ãŸã‚Šã€Google Oauth2.0 ã‚’ä½¿ã£ãŸãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ï¼ˆå¤‰æ›´ãŒã‚ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æŠœç²‹ï¼‰

```bash
/project-root
â”œâ”€â”€ /app
â”‚   â”œâ”€â”€ /(pages)
â”‚   â”‚   â”œ layout.tsx          # (pages)é…ä¸‹ã«é©ç”¨ã™ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œ want/page.tsx       # ä»Šæ¬²ã—ã„ã‚‚ã®ã‚’è¼‰ã›ã‚‹ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œ portfolio/page.tsx  # è‡ªå·±ç´¹ä»‹ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”” memo/page.tsx       # ãƒ¡ãƒ¢ã‚’è¼‰ã›ã‚‹ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ /components
â”‚   â”‚   â”œâ”€â”€ /ui               # å¿…è¦ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ google-login.tsx  # ãƒ­ã‚°ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ page.tsx              # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ layout.tsx            # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã«é©ç”¨ã™ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”œâ”€â”€ /public                   # å‹•ç”», faviconç½®ãå ´
â”œâ”€â”€ .env.local                # Google Oauthç”¨ã®CLIENT IDä¿å­˜
â”œâ”€â”€ env.ts                    # envãƒ•ã‚¡ã‚¤ãƒ«ã§å‹ã®undefinedå›é¿
â”œâ”€â”€ components.json           # shadcn/uiã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
...
```

## shadcn/ui ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç®¡ç†

### components.json

shadcn/ui ã®è¨­å®šã¯ä¸»ã«ã“ã® `components.json` ã§è¡Œã„ã¾ã™ã€‚
ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®è¨­å®šã‚’ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚„ import æ™‚ã®ãƒ‘ã‚¹ã‚’è‡ªç”±ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```json:components.json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/app/components",
    "utils": "@/app/lib/utils",
    "ui": "@/app/components/ui",
    "lib": "@/app/lib",
    "hooks": "@/app/hooks"
  },
  "iconLibrary": "lucide"
}
```

#### ãƒã‚¤ãƒ³ãƒˆ

- **shadcn/ui** ã¯ `components.json` ã§å„ç¨®è¨­å®šãŒç®¡ç†ã•ã‚Œã‚‹
- **aliases** ã§ `@/app/components/ui` ã‚„ `@/app/lib` ã¨ã„ã£ãŸãƒ‘ã‚¹ã‚’æŒ‡å®šã§ãã‚‹
- ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’ã€`/ui` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¾ã¨ã‚ã‚‹ãªã©æŸ”è»Ÿã«è¨­å®šã§ãã‚‹

## ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ (app/page.tsx)

ãƒ›ãƒ¼ãƒ ç”»é¢ã§ã¯èƒŒæ™¯å‹•ç”»ã‚’ãƒ«ãƒ¼ãƒ—ã•ã›ã¦è¡¨ç¤ºã—ã¤ã¤ã€ãƒœã‚¿ãƒ³ã«ãƒ›ãƒãƒ¼ã™ã‚‹ã¨å¯¾å¿œã—ãŸå‹•ç”»ãŒæµã‚Œã‚‹ä»•æ§˜ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«å‹•ç”»ãŒçµ‚äº†ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«æ¬¡ã®å‹•ç”»ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```tsx:app/page.tsx
"use client";

import { useEffect, useRef, useState } from "react";
import { Button } from "@/app/components/ui/button";
import Link from "next/link";

export default function Component() {
  const [currentVideoIndex, setCurrentVideoIndex] = useState(0);
  const videoRef = useRef<HTMLVideoElement>(null);

  const videos = ["/video1.mp4", "/video2.mp4", "/video3.mp4"];

  useEffect(() => {
    const videoElement = videoRef.current;
    if (!videoElement) return;

    const handleVideoEnd = () => {
      setCurrentVideoIndex((prevIndex) => (prevIndex + 1) % videos.length);
    };

    videoElement.addEventListener("ended", handleVideoEnd);

    return () => {
      videoElement.removeEventListener("ended", handleVideoEnd);
    };
  }, []);

  const getButtonText = (index: number) => {
    return index === 0 ? "want" : index === 1 ? "portfolio" : "memo";
  };

  const getButtonLink = (index: number) => {
    return `/${getButtonText(index)}`;
  };

  return (
    <div className="relative h-screen w-full overflow-hidden font-zilla-slab">
      <video
        ref={videoRef}
        className="absolute top-0 left-0 min-h-full min-w-full object-cover"
        src={videos[currentVideoIndex]}
        autoPlay
        muted
      />
      <div className="relative z-10 flex flex-col items-center justify-center h-full">
        <h1 className="text-3xl text-black mb-8">luck storage</h1>
        <div className="flex space-x-4">
          {[0, 1, 2].map((index) => (
            <Link key={index} href={getButtonLink(index)}>
              <Button
                className={`px-6 py-2 text-black transition-colors
                ${
                  index === currentVideoIndex
                    ? "bg-custom-button-hover"
                    : "bg-custom-button hover:bg-custom-button-hover"
                }`}
                onMouseEnter={() => setCurrentVideoIndex(index)}
              >
                {getButtonText(index)}
              </Button>
            </Link>
          ))}
        </div>
      </div>
    </div>
  );
}
```

### ãƒã‚¤ãƒ³ãƒˆ

1. **å‹•ç”»ã®åˆ‡ã‚Šæ›¿ãˆ**
   `useEffect` ã§å‹•ç”»ã®çµ‚äº†(`ended`)ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç›£è¦–ã—ã€`currentVideoIndex`ã‚’æ›´æ–°ã—ã¦æ¬¡ã®å‹•ç”»ã¸ã€‚
2. **ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼ã§å‹•ç”»åˆ‡ã‚Šæ›¿ãˆ**
   `onMouseEnter` ã§å‹•ç”»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å¤‰æ›´ã—ã¦ã€å¯¾å¿œã™ã‚‹å‹•ç”»ã«å³åˆ‡ã‚Šæ›¿ãˆã€‚

## ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (app/layout.tsx)

Next.js 13 App Router ã§ã¯ `app/layout.tsx` ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ãªã‚Šã¾ã™ã€‚
ã“ã“ã§ Google ãƒ•ã‚©ãƒ³ãƒˆã‚„ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªãƒ¡ã‚¿æƒ…å ±ã€`favicon` ã®è¨­å®šã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```tsx:app/layout.tsx
import type { Metadata } from "next";
import "./globals.css";
import { Zilla_Slab } from "next/font/google";

const zillaSlabFont = Zilla_Slab({
  subsets: ["latin"],
  weight: ["400", "700"],
});

export const metadata: Metadata = {
  title: "luck Storage",
  description: "luckã®å€‹äººçš„ãªãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã§ã™",
  icons: {
    icon: "/favicon.ico",
  },
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={zillaSlabFont.className}>
        {children}
      </body>
    </html>
  );
}
```

### ãƒã‚¤ãƒ³ãƒˆ

- **Google Fonts ã®é©ç”¨**:
  `next/font/google` ã‚’åˆ©ç”¨ã—ã¦ `Zilla_Slab` ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€`className` ã‚’ `body` ã«é©ç”¨
- **favicon ã¸ã®ãƒ‘ã‚¹è¨­å®š**:
  ãƒ«ãƒ¼ãƒˆã® public é…ä¸‹ã« `favicon.ico` ã‚’é…ç½®ã—ãŸãŸã‚ã€`/favicon.ico` ã§èª­ã¿è¾¼ã‚€

## ãƒšãƒ¼ã‚¸é…ä¸‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (app/(pages)/layout.tsx)

æ¬¡ã« `/(pages)` é…ä¸‹ã ã‘ã«é©ç”¨ã—ãŸã„å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ä¾‹ãˆã°ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ãŸã„å ´åˆãªã©ã¯ã“ã“ã«å®Ÿè£…ã—ã¾ã™ã€‚
ãªãŠã€**ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼ˆ/ï¼‰** ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã•ã›ãªã„ã‚ˆã†ã«ã™ã‚‹è¨­è¨ˆã§ã™ã€‚

```tsx:app/(pages)/layout.tsx
"use client";

import Link from "next/link";
import { Button } from "@/app/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/app/components/ui/dropdown-menu";
import { UserIcon } from "lucide-react";
import React from "react";
import LoginButton from "../components/google-login";

export default function PagesLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="min-h-screen flex flex-col">
      <header className="w-full p-4 bg-background border-b">
        <div className="w-full flex justify-between items-center">
          <div className="w-12">{/* Empty div for balance */}</div>
          <Link
            href="/"
            className="text-2xl text-center hover:text-primary transition-colors"
          >
            luck storage
          </Link>

          <div className="w-12 flex justify-end">
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button variant="ghost" size="icon">
                  <UserIcon className="h-5 w-5" />
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end">
                <DropdownMenuItem>
                  <LoginButton />
                </DropdownMenuItem>
                <DropdownMenuItem>admin</DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          </div>
        </div>
      </header>
      <main className="flex-grow">{children}</main>
    </div>
  );
}
```

### ãƒã‚¤ãƒ³ãƒˆ

- `/` ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ãªã„ã‹ã‚ã‚Šã«ã€`/(pages)` é…ä¸‹ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ˜ãƒƒãƒ€ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
- å°†æ¥çš„ã« `admin` é …ç›®ã‹ã‚‰ç·¨é›†ç”»é¢ã«é·ç§»ã•ã›ã‚‹äºˆå®š

## Google ãƒ­ã‚°ã‚¤ãƒ³ (app/components/google-login.tsx)

æœ€å¾Œã«ã€Google Oauth2.0 ã‚’ä½¿ã£ãŸãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã®å®Ÿè£…ä¾‹ã§ã™ã€‚
`react-oauth/google` ã‚’åˆ©ç”¨ã—ã€`GoogleOAuthProvider` ã§ãƒ©ãƒƒãƒ—ã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€`.env.local` ã« `NEXT_PUBLIC_GOOGLE_CLIENT_ID` ã‚’è¨­å®šã—ãŸã†ãˆã§ã€
`env.ts` ã‹ã‚‰ `GOOGLE_CLIENT_ID` ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¦ã€undefined ã®å¯èƒ½æ€§ã‚’æ’é™¤ã—ã¦ã„ã¾ã™ã€‚

```ts:env.ts
export const env = {
  GOOGLE_CLIENT_ID: process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID ?? "",
};
```

```tsx:app/components/google-login.tsx
import { GoogleOAuthProvider, useGoogleLogin } from "@react-oauth/google";
import { env } from "@/env";

function GoogleAuthComponentLogin() {
  const login = useGoogleLogin({
    flow: "implicit", // TODO: PKCEã®åˆ©ç”¨ã¸åˆ‡ã‚Šæ›¿ãˆäºˆå®š
    onSuccess: (tokenResponse) => {
      console.log(tokenResponse);
    },
    onError: () => {
      console.error("Login failed");
    },
    prompt: "select_account",
  });

  return (
    <button
      style={{ width: "-webkit-fill-available", textAlign: "left" }}
      onClick={() => login()}
    >
      login
    </button>
  );
}

export default function LoginButton() {
  return (
    <GoogleOAuthProvider clientId={env.GOOGLE_CLIENT_ID}>
      <GoogleAuthComponentLogin />
    </GoogleOAuthProvider>
  );
}
```

### ãƒã‚¤ãƒ³ãƒˆ

- ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†éš›ã« `env.ts` ã‚’æŒŸã¿ã€`env.GOOGLE_CLIENT_ID` ã§å‘¼ã³å‡ºã™
- `react-oauth/google` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã€**Implicit flow** ã§å‹•ä½œç¢ºèªä¸­
- ä»Šå¾Œ API å®Ÿè£…æ™‚ã« **PKCE + Token exchange** ã«åˆ‡ã‚Šæ›¿ãˆã‚‹äºˆå®š

&nbsp;
&nbsp;
&nbsp;
&nbsp;

ã“ã‚Œã§ã²ã¨ã¾ãšã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã€ã¨ã€Œãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã€å‘¨ã‚Šã®å®Ÿè£…ãŒå½¢ã«ãªã‚Šã¾ã—ãŸã€‚
ç¾åœ¨ã€Want ãƒšãƒ¼ã‚¸ã§ã¯ã€amazon ã®ãƒªãƒ³ã‚¯ãªã©ã‚’è²¼ã£ã¦ãã£ã‹ã‚‰å•†å“ç”»åƒã‚’æŠ½å‡ºã—ã¦ãã‚Œã‚‹ä»•çµ„ã¿ãŒã‚ã‚Œã°ä¾¿åˆ©ã ãªã¨è€ƒãˆã¦ã„ã¾ã™ã€‚æ¬¡å›ã¯ãã®å®Ÿç¾æ€§ã®èª¿æŸ»ã‹ã‚‰å…¥ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚

ä»¥ä¸Šã§ã™ã€‚
