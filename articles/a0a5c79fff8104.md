---
title: "Drizzle ORMå…¥é–€"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [drizzle]
published: true
---

è¿‘å¹´ã€åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦æ³¨ç›®ã‚’é›†ã‚ã¦ã„ã‚‹ã®ãŒ**Drizzle ORM**ã§ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€Drizzle ORM ã®åŸºæœ¬çš„ãªæ¦‚è¦ã‹ã‚‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•ã€ãã—ã¦å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã¾ã§ã‚’è§£èª¬ã—ã¾ã™ã€‚

## ãã‚‚ãã‚‚ ORM ã¨ã¯

ORMï¼ˆObject-Relational Mappingï¼‰ã¨ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®é–“ã®æ©‹æ¸¡ã—ã‚’è¡Œã†æŠ€è¡“ã§ã™ã€‚ORM ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã®ã‚¯ãƒ©ã‚¹ã¨ã—ã¦æ‰±ã„ã€SQL ã‚’ç›´æ¥æ›¸ãã“ã¨ãªããƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒå‘ä¸Šã—ã€é–‹ç™ºåŠ¹ç‡ãŒå¤§å¹…ã«ã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

## Drizzle ã®è‰¯ã•

Drizzle ORM ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç‰¹å¾´ã‚’æŒã¤æœ€æ–°ã® ORM ãƒ„ãƒ¼ãƒ«ã§ã™ï¼š

- **å‹å®‰å…¨æ€§**ï¼šTypeScript ã¨ã®é«˜ã„äº’æ›æ€§ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å‹ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚
- **SQL ãƒ©ã‚¤ã‚¯**ï¼šæ–‡æ³•ã‚’ SQL ã«ä¼¼ã›ã¦ãŠã‚Šã€SQL ã®çŸ¥è­˜ãŒã‚ã‚‹äººã§ã‚ã‚Œã°ç°¡å˜ã«ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
- **è»½é‡ã‹ã¤é«˜é€Ÿ**ï¼šä¸è¦ãªæ©Ÿèƒ½ã‚’æ’é™¤ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€é©åŒ–ã—ã¦ã„ã¾ã™ã€‚

å€‹äººçš„ã«ã¯ã€æ–°ãŸã«æ–‡æ³•ã‚’å­¦ã¶å¿…è¦ãŒãªã„ã®ãŒå¤§ãã„ã§ã™ã­ã€‚

## Drizzle ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Drizzle ORM ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å°å…¥ã™ã‚‹æ‰‹é †ã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚ä»¥ä¸‹ã«åŸºæœ¬çš„ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### 1. Drizzle ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã€Drizzle ORM ã¨ PostgreSQL ç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
npm install drizzle-orm drizzle-orm-postgres
```

### 2. PostgreSQL ã¸ã®æ¥ç¶šè¨­å®š

æ¬¡ã«ã€PostgreSQL ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã¯æ¥ç¶šè¨­å®šã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

```typescript
import { drizzle } from "drizzle-orm";
import { postgres } from "drizzle-orm/postgres";

const connection = postgres({
  user: "your_username",
  host: "localhost",
  database: "my_database",
  password: "your_password",
  port: 5432,
});

const db = drizzle(connection);
```

#### æ¥ç¶šè¨­å®šã®ãƒã‚¤ãƒ³ãƒˆ

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ›ã‚¹ãƒˆã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒãƒ¼ãƒˆç•ªå·**ã‚’è‡ªèº«ã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¾ã™ã€‚
- `drizzle`é–¢æ•°ã‚’ç”¨ã„ã¦ã€PostgreSQL ã¸ã®æ¥ç¶šã‚’ç¢ºç«‹ã—ã¾ã™ã€‚

## ãƒ†ãƒ¼ãƒ–ãƒ«ã®å®šç¾©

Drizzle ORM ã§ã¯ã€ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯`Users`ãƒ†ãƒ¼ãƒ–ãƒ«ã®å®šç¾©ä¾‹ã§ã™ã€‚

```typescript
import { Table, Column, Serial, Varchar, Int } from "drizzle-orm";

class Users extends Table {
  id = new Serial();
  name = new Varchar(100);
  age = new Int();
  email = new Varchar(100).unique();
}

const users = new Users();
```

### SQL ã§ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¨ã®æ¯”è¼ƒ

ä¸Šè¨˜ã®ã‚¯ãƒ©ã‚¹å®šç¾©ã¯ã€ä»¥ä¸‹ã® SQL æ–‡ã¨åŒç­‰ã®æ„å‘³ã‚’æŒã¡ã¾ã™ã€‚

```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100),
  age INT,
  email VARCHAR(100) UNIQUE
);
```

ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã®å®šç¾©ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã¨ã‚³ãƒ¼ãƒ‰ã®æ•´åˆæ€§ã‚’ä¿ã¡ã‚„ã™ããªã‚Šã¾ã™ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ

Drizzle ORM ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€CRUDï¼ˆCreate, Read, Update, Deleteï¼‰æ“ä½œã‚’ç›´æ„Ÿçš„ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã«åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

### ãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥ï¼š`insert`

æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’`Users`ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

```typescript
await db.insert(users).values({
  name: "ç”°ä¸­å¤ªéƒ",
  age: 28,
  email: "tanaka@example.com",
});
```

**å¯¾å¿œã™ã‚‹ SQL:**

```sql
INSERT INTO users (name, age, email)
VALUES ('ç”°ä¸­å¤ªéƒ', 28, 'tanaka@example.com');
```

### ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ï¼š`select`

æ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

```typescript
const result = await db.select(users).where(users.age.gt(25));
```

**å¯¾å¿œã™ã‚‹ SQL:**

```sql
SELECT * FROM users WHERE age > 25;
```

### ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ï¼š`update`

ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¹´é½¢ã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

```typescript
await db.update(users).set({ age: 29 }).where(users.name.eq("ç”°ä¸­å¤ªéƒ"));
```

**å¯¾å¿œã™ã‚‹ SQL:**

```sql
UPDATE users
SET age = 29
WHERE name = 'ç”°ä¸­å¤ªéƒ';
```

### ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ï¼š`delete`

æ¡ä»¶ã«åˆè‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

```typescript
await db.delete(users).where(users.age.lt(20));
```

**å¯¾å¿œã™ã‚‹ SQL:**

```sql
DELETE FROM users
WHERE age < 20;
```

## å®Ÿç”¨ä¾‹ï¼š URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿å–å¾—

Drizzle ORM ã‚’å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã©ã®ã‚ˆã†ã«æ´»ç”¨ã™ã‚‹ã‹ã€å…·ä½“çš„ãªå®Ÿç”¨ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€React ã® useParams ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ URL ã‹ã‚‰ layoutId ã‚’å–å¾—ã—ã€ãã‚Œã‚’åŸºã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰è©²å½“ã™ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæƒ…å ±ã‚’å–å¾—ã™ã‚‹ä¾‹ã§ã™ã€‚

```typescript
import { useParams } from "react-router-dom";
import { eq } from "drizzle-orm/expressions";
import { layoutTable } from "./tables";

const { layoutId } = useParams();
const id = Number(layoutId);
const layouts = await db
  .select()
  .from(layoutTable)
  .where(eq(layoutTable.layoutId, id));
```

### ã‚³ãƒ¼ãƒ‰è§£èª¬

#### 1. URL ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—

```typescript
const { layoutId } = useParams();
```

useParams ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã€URL ã‹ã‚‰ layoutId ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚

#### 2. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹å¤‰æ›

```typescript
const id = Number(layoutId);
```

å–å¾—ã—ãŸ layoutId ã¯æ–‡å­—åˆ—å‹ãªã®ã§ã€Number é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦æ•°å€¤å‹ã«å¤‰æ›ã—ã¾ã™ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã® layoutId ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ•°å€¤å‹ã§ã‚ã‚‹å ´åˆã€ã“ã®å¤‰æ›ã¯å¿…é ˆã§ã™ã€‚

#### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—

```typescript
const layouts = await db
  .select()
  .from(layoutTable)
  .where(eq(layoutTable.layoutId, id));
```

db.select()ã§ãƒ‡ãƒ¼ã‚¿ã®é¸æŠã‚’é–‹å§‹ã—ã¾ã™ã€‚
.from(layoutTable)ã§å¯¾è±¡ã¨ãªã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚
.where(eq(layoutTable.layoutId, id))ã§æ¡ä»¶ã‚’è¨­å®šã—ã€layoutId ãŒæŒ‡å®šã—ãŸ id ã¨ç­‰ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚
ã“ã®æ“ä½œã¯éåŒæœŸå‡¦ç†ã¨ãªã‚‹ãŸã‚ã€await ã‚’ä½¿ç”¨ã—ã¦çµæœã‚’å¾…ã¡ã¾ã™ã€‚
&nbsp;
ã‚‚ã¡ã‚ã‚“ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒã™ã‚‹æ™‚ã«ã‚‚ä½¿ãˆã¾ã™ã€‚
&nbsp;
&nbsp;
&nbsp;
&nbsp;
ä»¥ä¸Šã§ã™ã€‚
