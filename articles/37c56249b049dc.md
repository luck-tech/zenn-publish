---
title: "Route Handlerså…¥é–€"
emoji: "ğŸ˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [nextjs]
published: false
---

# Next.js Route Handlers ã«ã¤ã„ã¦

Next.js 13 ç³»ä»¥é™ã§ç™»å ´ã—ãŸ App Router ã§ã¯ã€å¾“æ¥ã® `pages` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä»‹ã—ãŸãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã¯ç•°ãªã‚‹ã€æ–°ãŸãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ–¹æ³•ãŒå°å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚ãã‚“ãªä¸­ã§ã€**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç°¡å˜ã«è¨­è¨ˆã§ãã‚‹ä»•çµ„ã¿**ã¨ã—ã¦ç™»å ´ã—ãŸã®ãŒ **Route Handlers** ã§ã™ã€‚ã“ã“ã§ã¯ã€Route Handlers ã®æ¦‚è¦ã‚„ä½¿ã„æ–¹ã€ãƒ«ãƒ¼ãƒ«ãªã©ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

---

## æ¦‚è¦

Next.js ãŒ App Router ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸå¾Œã€**ç”»é¢é·ç§»ç”¨ã®ãƒ«ãƒ¼ãƒˆ**ã¨**API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨ã®ãƒ«ãƒ¼ãƒˆ**ã‚’åˆ†é›¢ã—ã¦ã‚ˆã‚Šã‚ã‹ã‚Šã‚„ã™ãç®¡ç†ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã¨ã—ã¦ã€`route.js`(ã¾ãŸã¯ `route.ts`) ã‚’ä½¿ç”¨ã—ãŸ **Route Handlers** ãŒç™»å ´ã—ã¾ã—ãŸã€‚ç‰¹ã« **`GET` ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**ãŒå¼·åŠ›ãªç‰¹å¾´ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã‚’å‚ç…§ã—ãªã„é™ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹ã«ãªã‚‹ç‚¹ãŒå¤§ããªãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚

- **App Router ã®å¾Œã«ç™»å ´**  
  App Router ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ç”¨ã„ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’è¡Œã†ä»•çµ„ã¿ã§ã™ãŒã€ãã‚Œã«ä»˜éšã—ã¦ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¨˜è¿°ã‚‚åŒã˜æ§‹é€ å†…ã§ã‚·ãƒ³ãƒ—ãƒ«ã«å®šç¾©ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
- **ç°¡å˜ã« API è¨­è¨ˆãŒå¯èƒ½**  
  å¾“æ¥ã® `pages/api` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã¨æ¯”ã¹ã¦ã€é–¢é€£ã™ã‚‹ãƒšãƒ¼ã‚¸ã¨åŒã˜éšå±¤ï¼ˆã¾ãŸã¯è¿‘ã„éšå±¤ï¼‰ã§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã§ãã¾ã™ã€‚
- **GET ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½**  
  `GET` ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ï¼ˆãŸã¨ãˆã°ãƒ˜ãƒƒãƒ€ã‚„ã‚¯ãƒƒã‚­ãƒ¼ãªã©ï¼‰ã‚’å‚ç…§ã—ãªã„å ´åˆã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ãã¾ã™ã€‚ä¸è¦ã§ã‚ã‚Œã°ç„¡åŠ¹åŒ–ã™ã‚‹è¨­å®šã‚‚ç°¡å˜ã§ã™ã€‚

---

## ãƒ«ãƒ¼ãƒ«

Route Handlers ã‚’åˆ©ç”¨ã™ã‚‹ã«ã‚ãŸã£ã¦ã€ã„ãã¤ã‹å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã§ã¯ä¸»ãªãƒã‚¤ãƒ³ãƒˆã‚’æŒ™ã’ã¾ã™ã€‚

1. **`route.js` ã¨ `page.jsx`(ã¾ãŸã¯ `.tsx`) ã® 2 ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸»å½¹**

   - `page.jsx` ã¯ç”»é¢ãƒšãƒ¼ã‚¸ç”¨
   - `route.js` ã¯ API ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç”¨

2. **`route.js` ã¨ `page.jsx` ã¯åŒéšå±¤ã«ç½®ã‹ãªã„**  
   åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã« `route.js` ã¨ `page.jsx` ã‚’ä½µå­˜ã•ã›ã‚‹ã“ã¨ã¯é¿ã‘ã‚‹ã¹ãã§ã™ã€‚API å°‚ç”¨ã® `api` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã—ã€ãã®ç›´ä¸‹ã« `route.js` ã‚’é…ç½®ã™ã‚‹æ–¹æ³•ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚

3. **ä¸¡ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‚‚ã« `app` ãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã«é…ç½®ã™ã‚‹**  
   App Router ãŒæœ‰åŠ¹ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€`app` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒ«ãƒ¼ãƒˆã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ãŸã‚ã€ã“ã‚Œã«æº–æ‹ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

4. **`default export` ã¯ä¸è¦**  
   Route Handlers ã§ã¯ã€`export default` ã§ã¯ãªãã€HTTP ãƒ¡ã‚½ãƒƒãƒ‰åï¼ˆ`GET`, `POST`, `PUT`, `DELETE` ãªã©ï¼‰ã®é–¢æ•°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å½¢å¼ã‚’å–ã‚Šã¾ã™ã€‚

5. **é–¢æ•°åã‚’ãƒ¡ã‚½ãƒƒãƒ‰åã¨åŒä¸€ã«ã™ã‚‹**  
   ãŸã¨ãˆã°ã€`GET` ãƒ¡ã‚½ãƒƒãƒ‰ãªã‚‰ `export function GET() { ... }` ã®ã‚ˆã†ã«å®£è¨€ã—ã¾ã™ã€‚

6. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ `NextResponse` å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ˜ç¤ºçš„ã« return**  
   `NextResponse`ï¼ˆã¾ãŸã¯ `Response`ï¼‰ã‚’è¿”ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å®Œçµã•ã›ã¾ã™ã€‚

---

## å®Ÿè£…ä¾‹

æ¬¡ã«ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã¯ä¸»ã« `route.js` å†…ã§ã®è¨˜è¿°ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ãªãŠã€TypeScript ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Œã° `.tsx` / `.ts` ã‚’ä½¿ç”¨ã—ã€å‹å®šç¾©ã‚’è¿½åŠ ã—ã¦ãŠãã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ‰åŠ¹åŒ–ï¼ç„¡åŠ¹åŒ–

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `GET` ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¯¾ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæœ‰åŠ¹ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§åˆ¶å¾¡ã§ãã¾ã™ã€‚

```tsx
export const dynamic = "force-static"; // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹ã«ã—ãŸã„ãªã‚‰
export const dynamic = "force-dynamic"; // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹ã«ã—ãŸã„ãªã‚‰

import { NextRequest, NextResponse } from "next/server"; // req, resã«ãã‚Œãã‚Œå‹ãŒå­˜åœ¨

export function GET(req: NextRequest) {
  const res = NextResponse.json({ msg: "hello,world!" });
  return res;
}
```

### Cookie ã®èª­ã¿å–ã‚Šã¨è¨­å®š

#### `next/headers` ã‹ã‚‰ Cookie ã‚’æ‰±ã†ä¾‹

```tsx
import { cookies } from "next/headers";

export async function GET(request: Request) {
  const cookieStore = cookies();
  const token = cookieStore.get("token");

  return new Response("Hello, Next.js!", {
    status: 200,
    // Set-Cookie ãƒ˜ãƒƒãƒ€ã‚’ä½¿ç”¨ã—ã¦æ–°ã—ã„ Response ã‚’è¿”ã™ã“ã¨ã‚‚ã§ãã‚‹
    headers: { "Set-Cookie": `token=${token?.value}` },
  });
}
```

#### `NextRequest` ã‹ã‚‰ç›´æ¥ Cookie ã‚’èª­ã¿å–ã‚‹ä¾‹

```tsx
import { NextRequest } from "next/server";

export async function GET(request: NextRequest) {
  const token = request.cookies.get("token"); // req ã‹ã‚‰ cookie ã‚’å–å¾—
  return new Response(`Your token: ${token?.value}`);
}
```

### ãƒ˜ãƒƒãƒ€ã®èª­ã¿å–ã‚Šã¨è¨­å®š

```tsx
import { headers } from "next/headers";

export async function GET(request: Request) {
  const headersList = headers();
  const referer = headersList.get("referer");

  return new Response("Hello, Next.js!", {
    status: 200,
    // æ–°ã—ã header ã‚’è¨­å®šã™ã‚‹å ´åˆã‚‚æ–°ã—ã„ Response ã‚’è¿”ã™
    headers: { referer: referer || "" },
  });
}
```

#### `NextRequest` ã‹ã‚‰ Headers ã‚’å–ã‚Šå‡ºã™ä¾‹

```tsx
import { NextRequest } from "next/server";

export async function GET(request: NextRequest) {
  const requestHeaders = new Headers(request.headers);
  // `requestHeaders` ã«å¯¾ã—ã¦æ“ä½œãŒå¯èƒ½
  return new Response("Headers Processed");
}
```

### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

ç‰¹å®šã®ãƒ‘ã‚¹ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„å ´åˆã¯ã€`next/navigation` ã® `redirect` é–¢æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```tsx
import { redirect } from "next/navigation";

export async function GET(request: Request) {
  redirect("https://nextjs.org/");
}
```

### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—

`NextRequest` ã«ã¯ `nextUrl` ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã‚ã‚Šã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ç°¡å˜ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```tsx
import { NextRequest } from "next/server";

export function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams;
  const query = searchParams.get("query");
  // ä¾‹ãˆã° /api/search?query=hello ã®å ´åˆã€query ã«ã¯ "hello" ãŒå…¥ã‚‹
  return new Response(`Query is ${query}`);
}
```

### POST ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†

#### JSON ãƒ‡ãƒ¼ã‚¿ã®å—ã‘å–ã‚Š

```tsx
export async function POST(request: Request) {
  const res = await request.json();
  return Response.json({ res });
}
```

#### FormData ã®å—ã‘å–ã‚Š

`request.formData()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”¨ã„ã¦ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚

```tsx
export async function POST(request: Request) {
  const formData = await request.formData();
  const name = formData.get("name");
  const email = formData.get("email");
  return Response.json({ name, email });
}
```

---

> **å‚è€ƒãƒªãƒ³ã‚¯**
>
> - [Next.js Route Handler å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://beta.nextjs.org/docs/routing/route-handlers)
> - [Next.js 13 ã® Route Handlers ã«ç§»è¡Œã—ãŸãï¼](https://www.zenryoku-kun.com/post/nextjs-route-handler)

&nbsp;
&nbsp;
&nbsp;
&nbsp;

ä»¥ä¸Šã§ã™ã€‚
