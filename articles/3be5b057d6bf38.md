---
title: "AWS Amplify Ã— Cognitoèªè¨¼"
emoji: "ğŸ”’"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "amplify", "cognito", "react", "authentication"]
published: true
published_at: 2025-04-23 09:00
publication_name: "ka_projects"
---

# AWS Amplify Ã— Cognito ã§ã¯ã˜ã‚ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

## ã¯ã˜ã‚ã«

ã“ã®ã‚ã„ã ãƒãƒƒã‚«ã‚½ãƒ³ã«å‡ºå ´ã—ãŸéš›ã€ã‚¤ãƒ³ãƒ•ãƒ©ã¨ã—ã¦ AWS ã‚’æ¡ç”¨ã—ã€èªè¨¼ã¯ Cognito ã‚’ç”¨ã„ãŸ email, password æ–¹å¼ã«æ±ºå®šã—ã¾ã—ãŸã€‚ãã—ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰ Cognit ã«èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ãŸã‚ã«ä½¿ã£ãŸã®ãŒ AWS Amplify ã§ã™ã€‚
ã“ã®è¨˜äº‹ã¯ AWS Amplify ã‚’ç”¨ã„ãŸèªè¨¼ã«ã¤ã„ã¦ã®å‚™å¿˜éŒ²ã§ã™ã€‚

â€»ã“ã®è¨˜äº‹ã«æ›¸ã„ã¦ã„ã‚‹ã®ã¯ v5 ã®ã‚‚ã®ã§ã™ã€‚v6 ã¯å‚è€ƒæ–‡çŒ®ã‹ã‚‰é£›ã‚“ã§é•ã„ã‚’ç¢ºã‹ã‚ã¦ãã ã•ã„

## AWS Amplify ã¨ Amazon Cognito ã¨ã¯

### AWS Amplify

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…å‘ã‘ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€AWS ã®ã•ã¾ã–ã¾ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’ç°¡å˜ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ã‹ã§ä½¿ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ãŒã€èªè¨¼ã§ã‚‚ä½¿ãˆã‚‹ã‚‰ã—ã„ã€‚

### Amazon Cognito

è¦ã¯èªè¨¼ãƒ»èªå¯ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚è©³ã—ã„ã“ã¨ã¯èª¿ã¹ã¦ãã ã•ã„ã€‚

## ç’°å¢ƒæ§‹ç¯‰

### 1. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install aws-amplify
```

### 2. AWS Cognito ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã®ä½œæˆï¼ˆã‚¤ãƒ³ãƒ•ãƒ©å´ã®ä½œæ¥­ï¼‰

AWS Management Console ã‹ã‚‰:

1. Cognito ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã®ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ
4. ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€Œãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã‚’é¸æŠ
5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æ§‹æˆ
6. å¿…è¦ã«å¿œã˜ã¦ MFA ã‚„æ¤œè¨¼æ–¹æ³•ã‚’è¨­å®š
7. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã®åå‰ã‚’å…¥åŠ›ã—ã¦ä½œæˆ

ä½œæˆå¾Œã€ä»¥ä¸‹ã®æƒ…å ±ã‚’ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™:

- **User Pool ID**
- **App Client ID** (ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã‚¦ã‚§ãƒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID)

## Amplify ã®è¨­å®š

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã§ã€Amplify ã‚’è¨­å®šã—ã¾ã™ã€‚

```javascript
import { Amplify } from "aws-amplify";

Amplify.configure({
  Auth: {
    region: "ap-northeast-1",
    userPoolId: process.env.VITE_APP_USER_POOL_ID, // ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€
    userPoolWebClientId: process.env.VITE_APP_USER_POOL_CLIENT_ID, // ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã‚€
  },
});
```

ç’°å¢ƒå¤‰æ•°ã¯`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™(Vite ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ):

```
VITE_APP_USER_POOL_ID=ap-northeast-1_xxxxxxxxx
VITE_APP_USER_POOL_CLIENT_ID=xxxxxxxxxxxxxxxxxxxx
```

## èªè¨¼æ©Ÿèƒ½ã®å®Ÿè£…

### ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼‰

```javascript
import { Auth } from "aws-amplify";

const signUp = async (email, password) => {
  try {
    const { user } = await Auth.signUp({
      username: email,
      password,
    });
    console.log("ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—æˆåŠŸ:", user);
    return user;
  } catch (error) {
    console.error("ã‚¨ãƒ©ãƒ¼:", error);
    throw error;
  }
};
```

### ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèª

ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ãƒ¡ãƒ¼ãƒ«ã§ç¢ºèªã‚³ãƒ¼ãƒ‰ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚ãã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

```javascript
const confirmSignUp = async (email, code) => {
  try {
    await Auth.confirmSignUp(email, code);
    console.log("ç¢ºèªæˆåŠŸ");
    return true;
  } catch (error) {
    console.error("ç¢ºèªã‚¨ãƒ©ãƒ¼:", error);
    throw error;
  }
};
```

### ã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼‰

```javascript
const signIn = async (email, password) => {
  try {
    const user = await Auth.signIn(email, password);
    console.log("ã‚µã‚¤ãƒ³ã‚¤ãƒ³æˆåŠŸ:", user);
    return user;
  } catch (error) {
    console.error("ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:", error);
    throw error;
  }
};
```

### ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—

```javascript
const getCurrentUser = async () => {
  try {
    const userInfo = await Auth.currentAuthenticatedUser();
    console.log("ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼:", userInfo);
    return userInfo;
  } catch (error) {
    console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
    return null;
  }
};
```

### ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ

```javascript
const signOut = async () => {
  try {
    await Auth.signOut();
    console.log("ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆæˆåŠŸ");
    return true;
  } catch (error) {
    console.error("ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error);
    throw error;
  }
};
```

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸå ´åˆã®å‡¦ç†ã‚‚å®Ÿè£…ã—ã¦ãŠãã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

```javascript
// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã®é–‹å§‹
const forgotPassword = async (email) => {
  try {
    await Auth.forgotPassword(email);
    console.log("ç¢ºèªã‚³ãƒ¼ãƒ‰é€ä¿¡æˆåŠŸ");
    return true;
  } catch (error) {
    console.error("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:", error);
    throw error;
  }
};

// æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š
const forgotPasswordSubmit = async (email, code, newPassword) => {
  try {
    await Auth.forgotPasswordSubmit(email, code, newPassword);
    console.log("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæˆåŠŸ");
    return true;
  } catch (error) {
    console.error("æ–°ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã‚¨ãƒ©ãƒ¼:", error);
    throw error;
  }
};
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¤ã„ã¦

### 1. ç’°å¢ƒå¤‰æ•°ã®ä½¿ç”¨

å½“ãŸã‚Šå‰ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ« ID ã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã‚’ç›´æ¥ã‚³ãƒ¼ãƒ‰ã«åŸ‹ã‚è¾¼ã¾ãªã„ã§ãã ã•ã„ã€‚

### 2. ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜

signIn ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã« localStorage ã« userName(ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID) ã¨ idToken ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚å¼•ã£å¼µã‚Šå‡ºã™æ™‚ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦å¼•ã£å¼µã‚Šå‡ºã—ã¦ãã ã•ã„ã€‚

```ts
const userId = localStorage.getItem(
  `CognitoIdentityServiceProvider.${USER_POOL_CLIENT_ID}.LastAuthUser`
);
const idToken = localStorage.getItem(
  `CognitoIdentityServiceProvider.${USER_POOL_CLIENT_ID}.${userId}.idToken`
);
```

##ã€€ãŠã¾ã‘
[ã“ã¡ã‚‰](https://qiita.com/thirosue/items/1c32e43816ea1d6a204d)ã¯ Vue ã®è¨˜äº‹ã§ã™ãŒã€Google èªè¨¼ã‚’ é¸æŠã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‚‰ã—ã„ã§ã™ã€‚
[å…¬å¼ã®ãƒšãƒ¼ã‚¸](https://docs.amplify.aws/gen1/react-native/build-a-backend/auth/add-social-provider/)è¦‹ã¦ã‚‚ã€ç‰¹ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å†…å®¹ãªã©æ›¸ã‹ã‚Œã¦ã„ãªã„ã®ã§ã€Vite ã§ã‚‚å•é¡Œãªãã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [AWS Amplify å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.amplify.aws/gen1/react-native/build-a-backend/troubleshooting/migrate-from-javascript-v5-to-v6/)
- [aws-amplify ã® Auth ãƒ¡ã‚½ãƒƒãƒ‰ã®ä½¿ç”¨æ–¹æ³•ã®é•ã„(v5 ä»¥å‰ã¨ v6 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ¯”è¼ƒ)](https://qiita.com/KOH6/items/c9dac90658468a4cb609)
