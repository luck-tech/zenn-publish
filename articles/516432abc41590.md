---
title: "Next.js: ç´°ã‹ã„UI/UX å‘ä¸Šãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®ãƒ¡ãƒ¢"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, usetransition, nextjs, progressbar]
published: true
publication_name: "ka_projects"
---

## ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª UI ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ (`nextjs-toploader`)

ãƒšãƒ¼ã‚¸é·ç§»ã‚„`router.refresh()`å®Ÿè¡Œæ™‚ã«ã€ç”»é¢ä¸Šéƒ¨ã«ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’è¡¨ç¤ºã—ã¦ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã‚ã‚‹ã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã™ã‚‹ã€‚

`layout`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã™ã‚‹ã“ã¨ãªãå°å…¥ã§ãã‚‹`nextjs-toploader`ãŒæœ‰åŠ¹ã€‚

```tsx
// layout.tsx
import NextTopLoader from "nextjs-toploader";

export default function MainLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <>
      <NextTopLoader color="#EBC2AD" showSpinner={false} />
      <Header />
      <main className="pt-16">{children}</main>
    </>
  );
}
```

---

## ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ç®¡ç†ã¨ãƒ‡ãƒ¼ã‚¿åŒæœŸ (`Zustand`)

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§çŠ¶æ…‹ã‚’å…±æœ‰ã—ã€UI ã®ä¸€è²«æ€§ã‚’ä¿ã¤ãŸã‚ã« Zustand ã‚’å°å…¥ã€‚

`Header`ã¨`ProfileEditModal`ã®ã‚ˆã†ã«ã€é›¢ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’åŒæœŸã•ã›ã‚‹ã‚±ãƒ¼ã‚¹ã§æœ‰åŠ¹ã€‚`Header`ãŒæœ€åˆã«`fetchUser`ã‚’å‘¼ã³å‡ºã—ã¦ã‚¹ãƒˆã‚¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã—ã¦ãŠã‘ã°ã€`ProfileEditModal`ã¯ API é€šä¿¡ã®ãƒ©ã‚°ãªã—ã«åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆã‚¢ã‹ã‚‰å³åº§ã«èª­ã¿è¾¼ã‚ã‚‹ã€‚

**ã‚¹ãƒˆã‚¢ã®ä½œæˆ (`stores/userStore.ts`)**

```ts
import { create } from "zustand";

export const useUserStore = create<UserState>((set) => ({
  user: null,
  isLoading: true,
  fetchUser: async () => {
    try {
      const res = await fetch("/api/me");
      if (res.ok) {
        const data = await res.json();
        set({ user: data, isLoading: false });
      } else {
        set({ user: null, isLoading: false });
      }
    } catch (e) {
      set({ user: null, isLoading: false });
    }
  },
}));
```

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã®å‘¼ã³å‡ºã—**

```tsx
// Client Componentå†…
import { useUserStore } from "@/stores/userStore";

const { user, fetchUser } = useUserStore();
```

---

## åŒæœŸçš„ãª UI æ›´æ–°ã¨ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ (`useTransition`)

`router.refresh()`ã®ã‚ˆã†ãª Promise ã‚’è¿”ã•ãªã„éåŒæœŸå‡¦ç†ã¨ã€ãã‚Œã«ç¶šãçŠ¶æ…‹æ›´æ–°ã‚’ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ä¸Šã¯åŒæ™‚ã«ç™ºç”Ÿã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ã›ã‚‹ãŸã‚ã«`useTransition`ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

`startTransition`ã§ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸå‡¦ç†ã¯ä¸€ã¤ã®ã¾ã¨ã¾ã‚Šï¼ˆãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ï¼‰ã¨ã—ã¦ç®¡ç†ã•ã‚Œã‚‹ã€‚React ã¯ã€ãã®ä¸­ã§æœ€ã‚‚æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ï¼ˆ`router.refresh()`ï¼‰ãŒå®Œäº†ã™ã‚‹ã®ã‚’å¾…ã£ã¦ã‹ã‚‰ã€ã™ã¹ã¦ã®çŠ¶æ…‹æ›´æ–°ã‚’ä¸€åº¦ã«ç”»é¢ã«åæ˜ ã™ã‚‹ã€‚

```tsx
// Client Componentå†…
const [isPending, startTransition] = useTransition();

const handleUpdate = () => {
  // ... APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ãŸå¾Œ ...

  startTransition(() => {
    router.refresh(); // æ™‚é–“ã®ã‹ã‹ã‚‹UIæ›´æ–°
    setOpen(false); // å³æ™‚å®Ÿè¡Œã•ã‚Œã‚‹çŠ¶æ…‹æ›´æ–°
  });

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€refreshãŒå®Œäº†ã—ãŸå¾Œã«ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‰ã˜ãŸã‚ˆã†ã«è¦‹ãˆã‚‹
};
```
